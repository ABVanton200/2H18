<!DOCTYPE html>
<html>
 <head>
   <title>–û—Ç–ø—Ä–∞–≤–∫–∞ —Ñ–∞–π–ª–∞</title><meta charset="utf-8">
   <style>.r {border-radius: 50%; height: 28px; width: 28px; zoom: 150%}
     [type=file]  {display: none}
     #f2 {background: gold}
   </style>
 </head>
 <body><script src="https://kodaktor.ru/j/dblttl"></script>
  <div id="newform">
      <button id="b" class="r" title="–ü—Ä–∏–ª–æ–∂–∏—Ç—å —Ñ–∞–π–ª">üìé</button>
  </div>   
   <form method="post" id="frm" action="/zip"
         enctype="multipart/form-data" >
     <input name="fff" id="fff" type="file">
     <label for="fff">–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª</label><br><br>
   
     <input id="f1" type="submit" class="r"  value="‚úàÔ∏è" title="–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ñ–æ—Ä–º–æ–π">
     <button id="f2" class="r" title="–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–∫—Ä–∏–ø—Ç–æ–º">‚úàÔ∏è</button>
  </form>  
 
  <script>{
    const tf = document.querySelector('[type=file]');
    const reader = new FileReader(); 
      
    reader.onload = ({ target: { result: r } }) => {
       // console.log(r);
    };  
    document.querySelector('#b').addEventListener('click', e => {
      tf.dispatchEvent(new MouseEvent('click'));
    });
    tf.addEventListener('change', e => {
      if (tf.files[0]) {
        document.querySelector('label').textContent = tf.files[0].name;
        reader.readAsBinaryString(tf.files[0]);
      }  
    });    
    // –¥–ª—è xhr —Ç—Ä–µ–±–æ–≤–∞–ª—Å—è –±—ã FileReader
    document.querySelector('#f2')
    .addEventListener('click',  e => {
      (async () => {
        let r = await fetch(document.querySelector('#frm').action, {  
          method: 'POST',
          headers: {
            "my": "yes",
          },
          body: tf.files[0]  
        });
        const a = document.createElement('a');
        a.href = URL.createObjectURL(await r.blob());
        a.download = "my.zip";
        document.body.appendChild(a);  
        a.click();    
        a.remove();           
      })();
      e.preventDefault(); // —á—Ç–æ–±—ã —Ñ–æ—Ä–º–∞ –Ω–µ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–ª–∞
      // —ç—Ç–∞ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç –≤–Ω–µ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏
      // –∏–Ω–∞—á–µ –µ—Å–ª–∏ –≤–µ—Å—å —Å–ª—É—à–∞—Ç–µ–ª—å —Å–¥–µ–ª–∞—Ç—å async e
      // –∫–∞–∫ –≤ https://kodaktor.ru/filezip1_35b22
      // —Ç–æ —É–º–æ–ª—á–∞–Ω–Ω–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ —Ñ–æ—Ä–º—ã —É—Å–ø–µ–≤–∞–µ—Ç —Å—Ä–∞–±–æ—Ç–∞—Ç—å
    });  
  
  
}</script> 
 </body>
</html>